# 基于3d打印机的自动取样器

## 目的

封装出modbus、RS232等接口，简化PLC等上位机调用自动取样器的步骤

## 方案

3d打印机使用makebase主板，烧录修改版的marlin固件。

ESP32一共有3个串口，开发板USB占用1个串口（Serial），用于连接串口屏或者用过USB进行调试。
串口1（Serial1）用于和3d打印机的主板通讯，发送G-code，控制取样器归零、移动以及获取取样器位置等。
串口2（Serial2）使用RS232/RS486和PLC等上位机通信，提供封装好的接口。

## modbus通信协议

波特率9600，8位，无校验

站号20（0x14），只支持0x03（读取）和0x06（写）两种功能码，寄存器地址

```c
//*# 固件序列号，可用于区分不同的机器。使用M115查询
#define MACHINE_UUID "58ba5b7c-4bbb-11ee-be56-0242ac120e02"
废液瓶     G0 F3500 X2 Y18
1       G0 F3500 X39 Y0

```